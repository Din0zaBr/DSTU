import os
import numpy as np
from PIL import Image
import PySimpleGUI as sg
from TheoryOfInformation.lab1.main import main as new_main
import pickle


# C:\Users\ivanz\PycharmProjects\DSTU\TheoryOfInformation\sem6\3\abcd.png

# 11111111000000000000000011111111000000001111111100000000111111110000000000000000111111111111111111111111111111110000000011111111
# 000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000000111000000000111000000000111000000000111000010000111000010000111000010000111000000000111000000000111000000000111000000000111000010000111000000
# 11111111000000000000000011111111000000001111111100000000111111110000000000000000111111111111111111111111111111110000000011111111


def check_file_existence(file_path):
    if not os.path.isfile(file_path):
        sg.popup_error('Ошибка', 'Файл не существует')
        return False
    return True


def image_to_binary(image_path):
    """
    Convert image pixels to binary, then to hexadecimal, and finally encode using Huffman coding.

    :param image_path: Path to the image file.
    :return: Huffman-encoded string and the Huffman dictionary.
    """
    # Open the image
    image = Image.open(image_path)
    # Convert the image to a numpy array of pixels
    pixel_array = np.array(image)
    # Convert pixel values to binary (8 bits)
    binary_array = np.unpackbits(np.array(pixel_array, dtype=np.uint8), axis=-1)
    # Reshape binary array to have 8-bit chunks
    binary_array = binary_array.reshape(-1, 8)
    binary_string = ''.join(''.join(map(str, chunk)) for chunk in binary_array)
    print(binary_string)
    new_main()

    # result = np.array([list(x) for x in Encoded_output_text])
    # return result.transpose()



def main1():
    layout = [
        [sg.Text('Выберите изображение:')],
        [sg.Input(key='image_path'), sg.FileBrowse()],
        [sg.Button('Проверить файл')],
        [sg.Text('', size=(40, 1), key='result')],
        [sg.Button('Преобразовать в бинарный вид')],
        [sg.Multiline(size=(60, 10), key='binary_array')]
    ]

    window = sg.Window('Преобразование изображения', layout)

    while True:
        event, values = window.read()
        if event == sg.WIN_CLOSED:
            break
        elif event == 'Проверить файл':
            image_path = values['image_path']
            if check_file_existence(image_path):
                window['result'].update('Файл существует и корректен.')
            else:
                window['result'].update('Файл не найден или путь некорректен.')
        elif event == 'Преобразовать в бинарный вид':
            image_path = values['image_path']
            if check_file_existence(image_path):
                encoded_text = image_to_binary(image_path)
            else:
                sg.popup_error('Ошибка', 'Файл не найден или путь некорректен.')

    window.close()


if __name__ == '__main__':
    main()
